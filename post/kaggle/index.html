<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<title>Kaggleで企業の倒産予測に挑戦 &middot; kuzushikiのぺーじ</title>
	<link rel="canonical" href="https://kuzushiki.github.io/post/kaggle/">
	<link rel="stylesheet" type="text/css" href="https://kuzushiki.github.io/css/main.css" />
	


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172115536-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-172115536-1');
</script>

<meta property="og:site_name" content="kuzushikiのぺーじ" />
<meta property="og:title" content="Kaggleで企業の倒産予測に挑戦" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://kuzushiki.github.io/post/kaggle/" />
<meta property="og:locale" content="ja_JP" />

<meta property="og:image" content="https://kuzushiki.github.io/images/logo.png" />
<meta property="og:description" content="kaggleで起業の倒産予測にチャレンジしました 自身の研究で機械学習に触れていたこともあり、興味があったのでkaggleに初挑戦してみました！
チュートリアルとして有名なTitanic, House Pricesに加え、面白そうな問題だったCompanies bankruptcy forecast(企業の倒産予測)を解いてみました。" /></head>

<body>
	<a id="title" href="https://kuzushiki.github.io/" title="kuzushikiのぺーじ">
		
		<img id="logo" alt="Logo" src="https://kuzushiki.github.io/images/logo.png" />
		
		
		<h1>kuzushikiのぺーじ</h1>
		
	</a>
	
	<h4>セキュリティに関することを書きたいですね</h4>
	
	<div id="social">
		
		
		
		<a href="https://github.com/kuzushiki" title="Github">
			<img alt="GitHub" height="64px" width="64px" src="https://kuzushiki.github.io/images/github.svg" />
		</a>
		
		
		
		<a href="https://twitter.com/kuzu7shiki" title="Twitter">
			<img alt="Twitter" height="64px" width="64px" src="https://kuzushiki.github.io/images/twitter.svg" />
		</a>
		
		
		
	</div>
	<div class="links">
		<a href="https://kuzushiki.github.io/">Home</a>
		
		<a href="https://kuzushiki.github.io/post/">Archive</a>
		
		
		
		
		
		<a href="https://kuzushiki.github.io/pages/resume/">Résumé</a>
		
		
	</div>
	<div class="postBody">
		<div class="post">
			<h1>Kaggleで企業の倒産予測に挑戦</h1>
			<span class="post-meta">Mon, Mar 9, 2020 - Read in 4 Min</span>
			<div class="content">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#titanic">Titanic</a></li>
    <li><a href="#house-prices">House Prices</a></li>
    <li><a href="#companies-bankruptcy-forecast">Companies bankruptcy forecast</a></li>
    <li><a href="#感想">感想</a></li>
    <li><a href="#気になること">気になること</a></li>
  </ul>
</nav>
			<h1 id="kaggleで起業の倒産予測にチャレンジしました">kaggleで起業の倒産予測にチャレンジしました</h1>
<p>自身の研究で機械学習に触れていたこともあり、興味があったので<code>kaggle</code>に初挑戦してみました！</p>
<p>チュートリアルとして有名な<code>Titanic</code>, <code>House Prices</code>に加え、面白そうな問題だった<code>Companies bankruptcy forecast</code>(企業の倒産予測)を解いてみました。</p>
<h2 id="titanic">Titanic</h2>
<p>タイタニック号の生存者予測をする問題です。</p>
<p>この問題に関しては日本語のチュートリアルが沢山あるので説明は割愛させていただきます。</p>
<p><a href="https://www.kaggle.com/startupsci/titanic-data-science-solutions">このチュートリアル</a>を<del>ほぼコピペ</del>参考にしました。</p>
<p>結果は0.77511ポイントで9550位でした。</p>
<p><img src="https://user-images.githubusercontent.com/50363796/76205761-3c74bf80-623e-11ea-92d5-35d8ef01e131.png" alt="FireShot Capture 019 - Titanic_ Machine Learning from Disaster - Kaggle - www kaggle com"></p>
<h2 id="house-prices">House Prices</h2>
<p>家の値段を予想する問題です。</p>
<p>この問題も日本語のチュートリアルが沢山あるので説明は割愛させていただきます。</p>
<p>今回はコピペでは無く、自分で考えながらプログラムを書きました。</p>
<p>家の広さの指標が最も家賃に影響すると考えたので、以下のようなプログラムを作りました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LinearRegression
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;../input/house-prices-advanced-regression-techniques/train.csv&#34;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 結果は省略</span>
df<span style="color:#f92672">.</span>head()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># ここがオリジナル</span>
<span style="color:#75715e"># 1F, 2F, BFの面積を足したものをXとした</span>
X <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#34;1stFlrSF&#34;</span>]]<span style="color:#f92672">.</span>values <span style="color:#f92672">+</span> df[[<span style="color:#e6db74">&#34;2ndFlrSF&#34;</span>]]<span style="color:#f92672">.</span>values <span style="color:#f92672">+</span> df[[<span style="color:#e6db74">&#34;TotalBsmtSF&#34;</span>]]<span style="color:#f92672">.</span>values
y <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;SalePrice&#34;</span>]<span style="color:#f92672">.</span>values
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 線形回帰</span>
slr <span style="color:#f92672">=</span> LinearRegression()
slr<span style="color:#f92672">.</span>fit(X,y)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># NAを0に</span>
df_test <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;../input/house-prices-advanced-regression-techniques/test.csv&#34;</span>)
df_test[<span style="color:#e6db74">&#34;TotalBsmtSF&#34;</span>] <span style="color:#f92672">=</span> df_test[<span style="color:#e6db74">&#34;TotalBsmtSF&#34;</span>]<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">0</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 結果は省略</span>
df_test
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">X_test <span style="color:#f92672">=</span> df_test[[<span style="color:#e6db74">&#34;1stFlrSF&#34;</span>]]<span style="color:#f92672">.</span>values <span style="color:#f92672">+</span> df_test[[<span style="color:#e6db74">&#34;2ndFlrSF&#34;</span>]]<span style="color:#f92672">.</span>values <span style="color:#f92672">+</span> df_test[[<span style="color:#e6db74">&#34;TotalBsmtSF&#34;</span>]]<span style="color:#f92672">.</span>values
y_test <span style="color:#f92672">=</span> slr<span style="color:#f92672">.</span>predict(X_test)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_test[<span style="color:#e6db74">&#34;SalePrice&#34;</span>] <span style="color:#f92672">=</span> y_test
df_test[[<span style="color:#e6db74">&#34;Id&#34;</span>,<span style="color:#e6db74">&#34;SalePrice&#34;</span>]]<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#34;submission.csv&#34;</span>,index<span style="color:#f92672">=</span>False)
</code></pre></div><p>結果は0.24761ポイントで3833位でした</p>
<p><img src="https://user-images.githubusercontent.com/50363796/76205810-4c8c9f00-623e-11ea-891e-7a2d56ed2cb8.png" alt="FireShot Capture 022 - House Prices_ Advanced Regression Techniques - Kaggle - www kaggle com"></p>
<h2 id="companies-bankruptcy-forecast">Companies bankruptcy forecast</h2>
<p>日本語のサイトでオススメされている問題は上記の２つぐらいでした。</p>
<p>「次は何やろうか？」と色々問題を探していました。</p>
<p>すると、勉強会のメンバーの方が、「企業倒産予測」という面白そうな問題をやっていたので、自分もやってみることにしました。</p>
<p><a href="https://www.kaggle.com/c/companies-bankruptcy-forecast">問題のリンク</a></p>
<p>倒産を予測するにあたって、以下のデータがあります。</p>
<pre><code>Data fields
attr1 - net profit / total assets
attr2 - total liabilities / total assets
attr3 - working capital / total assets
attr4 - current assets / short-term liabilities
attr5 - [(cash + short-term securities + receivables - short-term liabilities) / (operating expenses - depreciation)] * 365
attr6 - retained earnings / total assets
attr7 - EBIT / total assets
attr8 - book value of equity / total liabilities
attr9 - sales / total assets
attr10 - equity / total assets
attr11 - (gross profit + extraordinary items + financial expenses) / total assets
attr12 - gross profit / short-term liabilities
attr13 - (gross profit + depreciation) / sales
attr14 - (gross profit + interest) / total assets
attr15 - (total liabilities * 365) / (gross profit + depreciation)
attr16 - (gross profit + depreciation) / total liabilities
attr17 - total assets / total liabilities
attr18 - gross profit / total assets
attr19 - gross profit / sales
attr20 - (inventory * 365) / sales
attr21 - sales (n) / sales (n-1)
attr22 - profit on operating activities / total assets
attr23 - net profit / sales
attr24 - gross profit (in 3 years) / total assets
attr25 - (equity - share capital) / total assets
attr26 - (net profit + depreciation) / total liabilities
attr27 - profit on operating activities / financial expenses
attr28 - working capital / fixed assets
attr29 - logarithm of total assets
attr30 - (total liabilities - cash) / sales
attr31 - (gross profit + interest) / sales
attr32 - (current liabilities * 365) / cost of products sold
attr33 - operating expenses / short-term liabilities
attr34 - operating expenses / total liabilities
attr35 - profit on sales / total assets
attr36 - total sales / total assets
attr37 - (current assets - inventories) / long-term liabilities
attr38 - constant capital / total assets
attr39 - profit on sales / sales
attr40 - (current assets - inventory - receivables) / short-term liabilities
attr41 - total liabilities / ((profit on operating activities + depreciation) * (12/365))
attr42 - profit on operating activities / sales
attr43 - rotation receivables + inventory turnover in days
attr44 - (receivables * 365) / sales
attr45 - net profit / inventory
attr46 - (current assets - inventory) / short-term liabilities
attr47 - (inventory * 365) / cost of products sold
attr48 - EBITDA (profit on operating activities - depreciation) / total assets
attr49 - EBITDA (profit on operating activities - depreciation) / sales
attr50 - current assets / total liabilities
attr51 - short-term liabilities / total assets
attr52 - (short-term liabilities * 365) / cost of products sold)
attr53 - equity / fixed assets
attr54 - constant capital / fixed assets
attr55 - working capital
attr56 - (sales - cost of products sold) / sales
attr57 - (current assets - inventory - short-term liabilities) / (sales - gross profit - depreciation)
attr58 - total costs /total sales
attr59 - long-term liabilities / equity
attr60 - sales / inventory
attr61 - sales / receivables
attr62 - (short-term liabilities *365) / sales
attr63 - sales / short-term liabilities
attr64 - sales / fixed assets
class - the response variable Y: 0 = did not bankrupt; 1 = bankrupt
</code></pre><p>種類が多い上に指標の意味が良く分かりません。</p>
<p>経済学を一切勉強してこなかったことを少し悔やみました。</p>
<p>とりあえず全部の指標を用いることにしました。</p>
<p>以下プログラム</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> pandas_profiling <span style="color:#f92672">as</span> pdp
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> sklearn.ensemble <span style="color:#f92672">import</span> RandomForestClassifier
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;../input/companies-bankruptcy-forecast/bankruptcy_Train.csv&#34;</span>)
df_test_class <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;../input/companies-bankruptcy-forecast/bankruptcy_Test_X.csv&#34;</span>)
df_test <span style="color:#f92672">=</span> df_test_class<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;ID&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_x <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;class&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_y <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;class&#34;</span>]
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">random_forest <span style="color:#f92672">=</span> RandomForestClassifier(n_estimators<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
random_forest<span style="color:#f92672">.</span>fit(df_x, df_y)
<span style="color:#75715e"># predict_probaを用いることで0,1ではなく確率を算出</span>
<span style="color:#75715e"># [:, 1] を付けると1(倒産)の確率を求められる</span>
Y_pred <span style="color:#f92672">=</span> random_forest<span style="color:#f92672">.</span>predict_proba(df_test)[:, <span style="color:#ae81ff">1</span>] 
Y_pred 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_test_class[<span style="color:#e6db74">&#34;class&#34;</span>] <span style="color:#f92672">=</span> Y_pred
df_test_class[[<span style="color:#e6db74">&#34;ID&#34;</span>,<span style="color:#e6db74">&#34;class&#34;</span>]]<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#34;submission.csv&#34;</span>,index<span style="color:#f92672">=</span>False)
</code></pre></div><p>結果は0.87537ポイントでした。</p>
<p>（終了済みのコンテストのせいか順位は出ませんでした。）</p>
<p><img src="https://user-images.githubusercontent.com/50363796/76205847-5d3d1500-623e-11ea-8277-91ef6e42f37c.png" alt="FireShot Capture 023 - Companies bankruptcy forecast - Kaggle - www kaggle com"></p>
<h2 id="感想">感想</h2>
<p>こんなに簡単にできるなんて！</p>
<p>ただ、上位を目指すにはデータの意味を考え、取捨選択をする必要があると感じました。</p>
<p>他にも数字の判定(MNIST)や動画の真偽判定(deepfake)のチュートリアルとなるnotebookを見て、ソースコードを読んだりしました。</p>
<p>気が向いたらまたやりたいですね。</p>
<h2 id="気になること">気になること</h2>
<p>この記事を書いていて思ったのですが、ipynbファイルを出力も含めて綺麗なmarkdownにするにはどうすればいいでしょう？</p>
<p><a href="https://github.com/aaren/notedown">このツール</a>を使いましたが、表の出力などがjson形式になってしまい、うまくできませんでした&hellip;</p>

			</div>
		</div>
	</div>
		<div class="links">
			<a href="https://kuzushiki.github.io/">Home</a>
			
				<a href="https://kuzushiki.github.io/post/">Archive</a>
			
			
				
			
				
					<a href="https://kuzushiki.github.io/pages/resume/">Résumé</a>
				
			
			<a href="#top">Top</a>
		</div>
		
		
		<p id="copyright">
			© Copyright 2020 kuzushiki
		</p>
		
	</body>
</html>

