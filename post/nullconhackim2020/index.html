<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<title>nullcon HackIM2020 write up &middot; kuzushikiのぺーじ</title>
	<link rel="canonical" href="https://kuzushiki.github.io/post/nullconhackim2020/">
	<link rel="stylesheet" type="text/css" href="https://kuzushiki.github.io/css/main.css" />
	


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172115536-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-172115536-1');
</script>

</head>

<body>
	<a id="title" href="https://kuzushiki.github.io/" title="kuzushikiのぺーじ">
		
		<img id="logo" alt="Logo" src="https://kuzushiki.github.io/images/logo.png" />
		
		
		<h1>kuzushikiのぺーじ</h1>
		
	</a>
	
	<h4>セキュリティに関することを書きたいですね</h4>
	
	<div id="social">
		
		
		
		<a href="https://github.com/kuzushiki" title="Github">
			<img alt="GitHub" height="64px" width="64px" src="https://kuzushiki.github.io/images/github.svg" />
		</a>
		
		
		
		<a href="https://twitter.com/kuzu7shiki" title="Twitter">
			<img alt="Twitter" height="64px" width="64px" src="https://kuzushiki.github.io/images/twitter.svg" />
		</a>
		
		
		
	</div>
	<div class="links">
		<a href="https://kuzushiki.github.io/">Home</a>
		
		<a href="https://kuzushiki.github.io/post/">Archive</a>
		
		
		
		
		
		<a href="https://kuzushiki.github.io/pages/resume/">Résumé</a>
		
		
	</div>
	<div class="postBody">
		<div class="post">
			<h1>nullcon HackIM2020 write up</h1>
			<span class="post-meta">Sat, Feb 15, 2020 - Read in 6 Min</span>
			<div class="content">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#rockpaperscissors">RockPaperScissors</a></li>
    <li><a href="#zelda1">Zelda1</a></li>
    <li><a href="#zelda2">Zelda2</a></li>
    <li><a href="#zelda3">Zelda3</a></li>
    <li><a href="#感想">感想</a></li>
  </ul>
</nav>
			<h1 id="nullcon-hackim-2020-に参加しました"><strong>nullcon HackIM 2020</strong> に参加しました！</h1>
<p>(team: team_Yamasan)</p>
<p>某CTFをやってみよう会にて参加しました。</p>
<p>普段は一人参加だったので、チームでやるのが新鮮で面白かったです。</p>
<p>合計476点を獲得し、最終結果は119位でした。</p>
<p>以下解けた問題のwrite up</p>
<h2 id="rockpaperscissors">RockPaperScissors</h2>
<p>じゃんけんをして20連勝すればいい</p>
<p>3^20分の1を当てるのはスマートでは無い</p>
<p>相手はコミットメントを生成し、勝負の前に表示してくれるので、コミットメントから出す手を推測できれば勝ちである</p>
<p>コミットメントは以下のように作られる（AESっぽい感じ）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sbox <span style="color:#f92672">=</span> [<span style="color:#ae81ff">221</span>, <span style="color:#ae81ff">229</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">119</span>, <span style="color:#ae81ff">143</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">239</span>, <span style="color:#ae81ff">118</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">207</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">199</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">181</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">139</span>, <span style="color:#ae81ff">98</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">223</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">173</span>, <span style="color:#ae81ff">220</span>, <span style="color:#ae81ff">238</span>, <span style="color:#ae81ff">217</span>, <span style="color:#ae81ff">152</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">132</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">55</span>, <span style="color:#ae81ff">125</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">254</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">193</span>, <span style="color:#ae81ff">147</span>, <span style="color:#ae81ff">248</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">174</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">216</span>, <span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">142</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">177</span>, <span style="color:#ae81ff">237</span>, <span style="color:#ae81ff">169</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">192</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">236</span>, <span style="color:#ae81ff">131</span>, <span style="color:#ae81ff">158</span>, <span style="color:#ae81ff">136</span>, <span style="color:#ae81ff">159</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">148</span>, <span style="color:#ae81ff">103</span>, <span style="color:#ae81ff">179</span>, <span style="color:#ae81ff">141</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">234</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">191</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">231</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">145</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">122</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">235</span>, <span style="color:#ae81ff">175</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">202</span>, <span style="color:#ae81ff">129</span>, <span style="color:#ae81ff">215</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">186</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">163</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">243</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">184</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">124</span>, <span style="color:#ae81ff">189</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">140</span>, <span style="color:#ae81ff">138</span>, <span style="color:#ae81ff">165</span>, <span style="color:#ae81ff">219</span>, <span style="color:#ae81ff">161</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">233</span>, <span style="color:#ae81ff">208</span>, <span style="color:#ae81ff">226</span>, <span style="color:#ae81ff">176</span>, <span style="color:#ae81ff">144</span>, <span style="color:#ae81ff">113</span>, <span style="color:#ae81ff">146</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">224</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">222</span>, <span style="color:#ae81ff">178</span>, <span style="color:#ae81ff">47</span>, <span style="color:#ae81ff">252</span>, <span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">134</span>, <span style="color:#ae81ff">249</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">198</span>, <span style="color:#ae81ff">164</span>, <span style="color:#ae81ff">203</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">170</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">137</span>, <span style="color:#ae81ff">204</span>, <span style="color:#ae81ff">157</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">168</span>, <span style="color:#ae81ff">162</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">253</span>, <span style="color:#ae81ff">213</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">171</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">53</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">232</span>, <span style="color:#ae81ff">242</span>, <span style="color:#ae81ff">244</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">212</span>, <span style="color:#ae81ff">187</span>, <span style="color:#ae81ff">205</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">182</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">107</span>, <span style="color:#ae81ff">245</span>, <span style="color:#ae81ff">211</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">195</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">197</span>, <span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">183</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">167</span>, <span style="color:#ae81ff">154</span>, <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">151</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">247</span>, <span style="color:#ae81ff">246</span>, <span style="color:#ae81ff">153</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">149</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">230</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">188</span>, <span style="color:#ae81ff">172</span>, <span style="color:#ae81ff">241</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">49</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">214</span>, <span style="color:#ae81ff">155</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">160</span>, <span style="color:#ae81ff">135</span>, <span style="color:#ae81ff">104</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">190</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">97</span>, <span style="color:#ae81ff">251</span>, <span style="color:#ae81ff">218</span>, <span style="color:#ae81ff">133</span>, <span style="color:#ae81ff">209</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">227</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">166</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">25</span>]
p <span style="color:#f92672">=</span> [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">2</span>]
round <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_commitments</span>():
    secret <span style="color:#f92672">=</span> bytearray(Random<span style="color:#f92672">.</span>get_random_bytes(<span style="color:#ae81ff">16</span>))
    rc <span style="color:#f92672">=</span> hash(secret <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;r&#34;</span>)
    pc <span style="color:#f92672">=</span> hash(secret <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;p&#34;</span>)
    sc <span style="color:#f92672">=</span> hash(secret <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;s&#34;</span>)
    secret <span style="color:#f92672">=</span> hex(bytes_to_int(secret))[<span style="color:#ae81ff">2</span>:]
    rps <span style="color:#f92672">=</span> [(<span style="color:#e6db74">&#34;r&#34;</span>, rc), (<span style="color:#e6db74">&#34;p&#34;</span>, pc), (<span style="color:#e6db74">&#34;s&#34;</span>, sc)]
    <span style="color:#66d9ef">print</span>(rps)
    random<span style="color:#f92672">.</span>shuffle(rps)
    <span style="color:#66d9ef">return</span> secret, rps

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hash</span>(data):
    state <span style="color:#f92672">=</span> bytearray([<span style="color:#ae81ff">208</span>, <span style="color:#ae81ff">151</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">223</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">2</span>])
    data <span style="color:#f92672">=</span> pad(data, <span style="color:#ae81ff">16</span>)
    <span style="color:#66d9ef">print</span>(data)
    data <span style="color:#f92672">=</span> group(data)
    <span style="color:#66d9ef">print</span>(data)
    <span style="color:#66d9ef">for</span> roundkey <span style="color:#f92672">in</span> data:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;roundkey&#34;</span>, roundkey)
        <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(round):
            state <span style="color:#f92672">=</span> repeated_xor(state, roundkey)
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(state)):
                state[i] <span style="color:#f92672">=</span> sbox[state[i]]
            temp <span style="color:#f92672">=</span> bytearray(<span style="color:#ae81ff">16</span>)
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(state)):
                temp[p[i]] <span style="color:#f92672">=</span> state[i]
            state <span style="color:#f92672">=</span> temp
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;state&#34;</span>, state)
    <span style="color:#66d9ef">return</span> hex(bytes_to_int(state))[<span style="color:#ae81ff">2</span>:]
</code></pre></div><p>概要をざっくり説明すると、<code>gen_commitments</code>では<code>secret</code>をまず生成し、それにそれぞれの手を足したものを<code>hash</code>に投げている</p>
<p><code>hash</code>では入力をパディングし、分割し、パーツごとにXOR, 置換などのAESっぽい処理をする</p>
<p>例えばパーの場合は<code>b'/\xdcF\xcd1x\xa9\x02%\x12\xba\x81\x17\xff$^</code>と
<code>b'p\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f'</code>に分けられる</p>
<p>2つ目のパーツの先頭1バイトが<code>p,r,c</code>のいずれかになることを利用する</p>
<p><code>hash</code>には乱数を使った処理が無いので、逆算が可能である</p>
<p>得られるコミットメントにたいして<code>hash</code>と逆の処理を施してあげれば、元の入力を求められるはずである</p>
<p>以下のような関数を作る</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dec_hash</span>(old_state_list):
    roundkey_list <span style="color:#f92672">=</span> [bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;r</span><span style="color:#ae81ff">\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f</span><span style="color:#e6db74">&#39;</span>),
        bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;p</span><span style="color:#ae81ff">\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f</span><span style="color:#e6db74">&#39;</span>),
        bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;s</span><span style="color:#ae81ff">\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f</span><span style="color:#e6db74">&#39;</span>)
        ]

    total_state_list <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> old_state <span style="color:#f92672">in</span> old_state_list:
        new_state_list <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> roundkey <span style="color:#f92672">in</span> roundkey_list:
            state <span style="color:#f92672">=</span> int_to_bytes(old_state)
            temp <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(state)
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(state)):
                temp[i]  <span style="color:#f92672">=</span> state[p[i]]
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(state)):
                temp[i] <span style="color:#f92672">=</span> sbox<span style="color:#f92672">.</span>index(temp[i])
            new_state <span style="color:#f92672">=</span> repeated_xor(temp, roundkey)
            new_state_list<span style="color:#f92672">.</span>append(new_state[<span style="color:#ae81ff">0</span>])
        total_state_list<span style="color:#f92672">.</span>append(new_state_list)
    <span style="color:#66d9ef">return</span> total_state_list
</code></pre></div><p>復号結果は以下のようになる</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[
    [bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;#</span><span style="color:#ae81ff">\xb6\xcb\xa6\x85</span><span style="color:#e6db74">0!</span><span style="color:#ae81ff">\xed</span><span style="color:#e6db74">r</span><span style="color:#ae81ff">\x15\x1c</span><span style="color:#e6db74">&gt;</span><span style="color:#ae81ff">\x89\xe7</span><span style="color:#e6db74">Ch&#39;</span>), 
    bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;!</span><span style="color:#ae81ff">\xb6\xcb\xa6\x85</span><span style="color:#e6db74">0!</span><span style="color:#ae81ff">\xed</span><span style="color:#e6db74">r</span><span style="color:#ae81ff">\x15\x1c</span><span style="color:#e6db74">&gt;</span><span style="color:#ae81ff">\x89\xe7</span><span style="color:#e6db74">Ch&#39;</span>), 
    bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#34;</span><span style="color:#ae81ff">\xb6\xcb\xa6\x85</span><span style="color:#e6db74">0!</span><span style="color:#ae81ff">\xed</span><span style="color:#e6db74">r</span><span style="color:#ae81ff">\x15\x1c</span><span style="color:#e6db74">&gt;</span><span style="color:#ae81ff">\x89\xe7</span><span style="color:#e6db74">Ch&#39;</span>)],

    [bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; W</span><span style="color:#ae81ff">\x05\xa4\xdc\xfa\xdf\xe6\x90</span><span style="color:#e6db74">dJM</span><span style="color:#ae81ff">\xb2\x10</span><span style="color:#e6db74">Et&#39;</span>), 
    bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#34;W</span><span style="color:#ae81ff">\x05\xa4\xdc\xfa\xdf\xe6\x90</span><span style="color:#e6db74">dJM</span><span style="color:#ae81ff">\xb2\x10</span><span style="color:#e6db74">Et&#39;</span>), 
    bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;!W</span><span style="color:#ae81ff">\x05\xa4\xdc\xfa\xdf\xe6\x90</span><span style="color:#e6db74">dJM</span><span style="color:#ae81ff">\xb2\x10</span><span style="color:#e6db74">Et&#39;</span>)], 

    [bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#34;8</span><span style="color:#ae81ff">\xa1\x9f\n\xe4\xbf</span><span style="color:#e6db74">u</span><span style="color:#ae81ff">\xf2</span><span style="color:#e6db74">6</span><span style="color:#ae81ff">\xd7\xdd\xf6\x81</span><span style="color:#e6db74">6</span><span style="color:#ae81ff">\xf0</span><span style="color:#e6db74">&#39;</span>), 
    bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; 8</span><span style="color:#ae81ff">\xa1\x9f\n\xe4\xbf</span><span style="color:#e6db74">u</span><span style="color:#ae81ff">\xf2</span><span style="color:#e6db74">6</span><span style="color:#ae81ff">\xd7\xdd\xf6\x81</span><span style="color:#e6db74">6</span><span style="color:#ae81ff">\xf0</span><span style="color:#e6db74">&#39;</span>), 
    bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;#8</span><span style="color:#ae81ff">\xa1\x9f\n\xe4\xbf</span><span style="color:#e6db74">u</span><span style="color:#ae81ff">\xf2</span><span style="color:#e6db74">6</span><span style="color:#ae81ff">\xd7\xdd\xf6\x81</span><span style="color:#e6db74">6</span><span style="color:#ae81ff">\xf0</span><span style="color:#e6db74">&#39;</span>)]]
</code></pre></div><p>３つのコミットメントを<code>r,p,c</code>のそれぞれで復号してみたもの</p>
<p>すると復号結果の1バイト目が一致することが分かる（上の例では<code>b'&quot;'</code>）</p>
<p>これが一致しているものが正解である</p>
<p>上の例では上からチョキ、グー、パーとなる</p>
<p>（なぜ1バイト目しか一致しないのかは分かりませんでした）</p>
<p>後はコミットメントを読み取り、復号し、出す手を決めて送るプログラムをつくる</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> time

<span style="color:#f92672">from</span> Crypto <span style="color:#f92672">import</span> Random
<span style="color:#f92672">from</span> Crypto.Random <span style="color:#f92672">import</span> random
<span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

sbox <span style="color:#f92672">=</span> [<span style="color:#ae81ff">221</span>, <span style="color:#ae81ff">229</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">119</span>, <span style="color:#ae81ff">143</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">239</span>, <span style="color:#ae81ff">118</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">207</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">199</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">181</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">139</span>, <span style="color:#ae81ff">98</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">223</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">173</span>, <span style="color:#ae81ff">220</span>, <span style="color:#ae81ff">238</span>, <span style="color:#ae81ff">217</span>, <span style="color:#ae81ff">152</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">132</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">55</span>, <span style="color:#ae81ff">125</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">254</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">193</span>, <span style="color:#ae81ff">147</span>, <span style="color:#ae81ff">248</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">174</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">216</span>, <span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">142</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">177</span>, <span style="color:#ae81ff">237</span>, <span style="color:#ae81ff">169</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">192</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">236</span>, <span style="color:#ae81ff">131</span>, <span style="color:#ae81ff">158</span>, <span style="color:#ae81ff">136</span>, <span style="color:#ae81ff">159</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">148</span>, <span style="color:#ae81ff">103</span>, <span style="color:#ae81ff">179</span>, <span style="color:#ae81ff">141</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">234</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">191</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">231</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">145</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">122</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">235</span>, <span style="color:#ae81ff">175</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">202</span>, <span style="color:#ae81ff">129</span>, <span style="color:#ae81ff">215</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">186</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">163</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">243</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">184</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">124</span>, <span style="color:#ae81ff">189</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">140</span>, <span style="color:#ae81ff">138</span>, <span style="color:#ae81ff">165</span>, <span style="color:#ae81ff">219</span>, <span style="color:#ae81ff">161</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">233</span>, <span style="color:#ae81ff">208</span>, <span style="color:#ae81ff">226</span>, <span style="color:#ae81ff">176</span>, <span style="color:#ae81ff">144</span>, <span style="color:#ae81ff">113</span>, <span style="color:#ae81ff">146</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">224</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">222</span>, <span style="color:#ae81ff">178</span>, <span style="color:#ae81ff">47</span>, <span style="color:#ae81ff">252</span>, <span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">134</span>, <span style="color:#ae81ff">249</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">198</span>, <span style="color:#ae81ff">164</span>, <span style="color:#ae81ff">203</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">170</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">137</span>, <span style="color:#ae81ff">204</span>, <span style="color:#ae81ff">157</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">168</span>, <span style="color:#ae81ff">162</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">253</span>, <span style="color:#ae81ff">213</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">171</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">53</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">232</span>, <span style="color:#ae81ff">242</span>, <span style="color:#ae81ff">244</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">212</span>, <span style="color:#ae81ff">187</span>, <span style="color:#ae81ff">205</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">182</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">107</span>, <span style="color:#ae81ff">245</span>, <span style="color:#ae81ff">211</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">195</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">197</span>, <span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">183</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">167</span>, <span style="color:#ae81ff">154</span>, <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">151</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">247</span>, <span style="color:#ae81ff">246</span>, <span style="color:#ae81ff">153</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">149</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">230</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">188</span>, <span style="color:#ae81ff">172</span>, <span style="color:#ae81ff">241</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">49</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">214</span>, <span style="color:#ae81ff">155</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">160</span>, <span style="color:#ae81ff">135</span>, <span style="color:#ae81ff">104</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">190</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">97</span>, <span style="color:#ae81ff">251</span>, <span style="color:#ae81ff">218</span>, <span style="color:#ae81ff">133</span>, <span style="color:#ae81ff">209</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">227</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">166</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">25</span>]
p <span style="color:#f92672">=</span> [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">2</span>]
round <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pad</span>(data, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>):
    pad_byte <span style="color:#f92672">=</span> (size <span style="color:#f92672">-</span> len(data) <span style="color:#f92672">%</span> size) <span style="color:#f92672">%</span> size
    data <span style="color:#f92672">=</span> data <span style="color:#f92672">+</span> bytearray([pad_byte]) <span style="color:#f92672">*</span> pad_byte
    <span style="color:#66d9ef">return</span> data


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">repeated_xor</span>(p, k):
    <span style="color:#66d9ef">return</span> bytearray([p[i] <span style="color:#f92672">^</span> k[i <span style="color:#f92672">%</span> len(k)] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(p))])


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">bytes_to_int</span>(xbytes):
    <span style="color:#66d9ef">return</span> bytes_to_long(xbytes)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">int_to_bytes</span>(x):
    <span style="color:#66d9ef">return</span> long_to_bytes(x, <span style="color:#ae81ff">16</span>)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">group</span>(input, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>):
    <span style="color:#66d9ef">return</span> [input[i <span style="color:#f92672">*</span> size: (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> size] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(input) <span style="color:#f92672">//</span> size)]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dec_hash</span>(old_state_list):
    roundkey_list <span style="color:#f92672">=</span> [bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;r</span><span style="color:#ae81ff">\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f</span><span style="color:#e6db74">&#39;</span>),
        bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;p</span><span style="color:#ae81ff">\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f</span><span style="color:#e6db74">&#39;</span>),
        bytearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;s</span><span style="color:#ae81ff">\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f\x0f</span><span style="color:#e6db74">&#39;</span>)
        ]

    total_state_list <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> old_state <span style="color:#f92672">in</span> old_state_list:
        new_state_list <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> roundkey <span style="color:#f92672">in</span> roundkey_list:
            state <span style="color:#f92672">=</span> int_to_bytes(old_state)
            temp <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(state)
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(state)):
                temp[i]  <span style="color:#f92672">=</span> state[p[i]]
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(state)):
                temp[i] <span style="color:#f92672">=</span> sbox<span style="color:#f92672">.</span>index(temp[i])
            new_state <span style="color:#f92672">=</span> repeated_xor(temp, roundkey)
            new_state_list<span style="color:#f92672">.</span>append(new_state[<span style="color:#ae81ff">0</span>])
        total_state_list<span style="color:#f92672">.</span>append(new_state_list)
    <span style="color:#66d9ef">return</span> total_state_list

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_hand</span>(total_state_list):
    s1, s2, s3 <span style="color:#f92672">=</span> map(<span style="color:#66d9ef">lambda</span> state: set(state), total_state_list)
    dup <span style="color:#f92672">=</span> s1 <span style="color:#f92672">&amp;</span> s2 <span style="color:#f92672">&amp;</span> s3
    dup <span style="color:#f92672">=</span> list(dup)[<span style="color:#ae81ff">0</span>]
    <span style="color:#66d9ef">if</span> total_state_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>index(dup) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;p&#39;</span>
    <span style="color:#66d9ef">elif</span> total_state_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>index(dup) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;s&#39;</span>
    <span style="color:#66d9ef">elif</span> total_state_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>index(dup) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;r&#39;</span>

io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;crypto1.ctf.nullcon.net&#39;</span>, <span style="color:#ae81ff">5000</span>)
recv_data <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>):
    state_list <span style="color:#f92672">=</span> [recv_data<span style="color:#f92672">.</span>split(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>], recv_data<span style="color:#f92672">.</span>split(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>], recv_data<span style="color:#f92672">.</span>split(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>][:<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>]]
    <span style="color:#75715e"># print(state_list)</span>
    dec_list <span style="color:#f92672">=</span> dec_hash(list(map(<span style="color:#66d9ef">lambda</span> s: int(s, <span style="color:#ae81ff">16</span>), state_list)))
    <span style="color:#66d9ef">print</span>(my_hand(dec_list))
    io<span style="color:#f92672">.</span>sendline(my_hand(dec_list))
    recv_data <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    <span style="color:#66d9ef">print</span>(recv_data)

io<span style="color:#f92672">.</span>interactive()
</code></pre></div><p>フラグゲット
<code>hackim20{b4d_pr1mitiv3_beats_all!1!_7f65}</code></p>
<h2 id="zelda1">Zelda1</h2>
<p>正式な問題名は忘れた。</p>
<p>Unity製のゼルダっぽいゲームが配布される</p>
<p>敵を倒すのが目的だが、敵に接触してもお互いノックバックするだけ</p>
<p>スペースキーで剣を振れるが、当てても接触したときと同じ</p>
<p><code>dnSpy</code>というソフトを使って解析する</p>
<p>Unity製のゲームはC#で書かれており、
そのソースコードは<code>Managed/Assembly-CSharp.dll</code>を解析することで確認できる。</p>
<p>敵を倒すアプローチは、こちらの攻撃力を上げる方法と敵のHPをゼロにする方法などが考えられるが、
今回は後者のチートを試みる。</p>
<p>敵のHPに関係しそうなメソッドを見てみる</p>
<p><code>Enemy</code>クラスに<code>TakeDamage</code>という関数がある</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> TakeDamage(<span style="color:#66d9ef">float</span> damage)
{
	<span style="color:#66d9ef">this</span>.health -= damage;
	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.health &lt;= <span style="color:#ae81ff">0f</span>)
	{
		<span style="color:#66d9ef">base</span>.StartCoroutine(<span style="color:#66d9ef">this</span>.ShowSome());
		<span style="color:#66d9ef">base</span>.gameObject.SetActive(<span style="color:#66d9ef">false</span>);
	}
}
</code></pre></div><p>どうやら<code>this.health &lt;= 0f</code>を<code>true</code>にすれば倒せそうだ</p>
<p>というわけで判定文を以下のようにいじる</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> TakeDamage(<span style="color:#66d9ef">float</span> damage)
{
	<span style="color:#66d9ef">this</span>.health -= damage;
	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.health &lt;= <span style="color:#ae81ff">999999f</span>)
	{
		<span style="color:#66d9ef">base</span>.StartCoroutine(<span style="color:#66d9ef">this</span>.ShowSome());
		<span style="color:#66d9ef">base</span>.gameObject.SetActive(<span style="color:#66d9ef">false</span>);
	}
}
</code></pre></div><p>ゲームを実行してみる</p>
<p>敵に接触した瞬間に敵が消え、画面上部にフラグが現れる</p>
<p><code>Flag: REVOLUTIONSTARTSWITHME</code></p>
<h2 id="zelda2">Zelda2</h2>
<p>先ほどと同じゲームにフラグが隠されている</p>
<p>今回は通常は入れない池の中に侵入するのが目的</p>
<p>また<code>dnSpy</code>というソフトを使って解析する</p>
<p>どこを変更すればいいか分からなかったので「Unity 障害物 すり抜け」などのキーワードでググる</p>
<p><a href="https://qiita.com/_tybt/items/0e9605b7acc955078c64">こんなページ</a>が見つかった</p>
<p>どうやら<code>Dynamic</code>ではなく<code>Kinematic</code>という設定にすれば良いらしい</p>
<p><code>kinematic</code>で検索すると<code>isKinematic</code>というメソッドが見つかる</p>
<p>(検索オプションの<code>Match Any Search Item</code>にチェックを入れること！)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> isKinematic
		{
			<span style="color:#66d9ef">get</span>
			{
				<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.bodyType == RigidbodyType2D.Kinematic;
			}
			<span style="color:#66d9ef">set</span>
			{
				<span style="color:#66d9ef">this</span>.bodyType = ((!<span style="color:#66d9ef">value</span>) ? RigidbodyType2D.Dynamic : RigidbodyType2D.Kinematic);
			}
		}
</code></pre></div><p><code>Kinematic</code>にするかどうかを決めているらしい</p>
<p>常時<code>Kinematic</code>にするために、<code>set</code>を変更する</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> isKinematic
		{
			<span style="color:#66d9ef">get</span>
			{
				<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.bodyType == RigidbodyType2D.Kinematic;
			}
			<span style="color:#66d9ef">set</span>
			{
				<span style="color:#66d9ef">this</span>.bodyType = RigidbodyType2D.Kinematic;
			}
		}
</code></pre></div><p>ゲームを実行してみる</p>
<p>池に入ると、フラグが書かれたエリアにワープする</p>
<p><code>FLAG IS BENDTHERULES42PIRATE</code></p>
<h2 id="zelda3">Zelda3</h2>
<p>先ほどと同じゲームにフラグが隠されている</p>
<p>今回はゲームエリアの端っこに行くのが目的</p>
<p>また<code>dnSpy</code>というソフトを使って解析する</p>
<p>先ほどのチートで障害物をすり抜けることはできたので、今度は移動スピードを上げることを考える</p>
<p>移動スピードは以下のメソッドで計算される</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> MoveCharacter()
{
	<span style="color:#66d9ef">this</span>.change.Normalize();
	<span style="color:#66d9ef">this</span>.myRigidbody.MovePosition(<span style="color:#66d9ef">base</span>.transform.position + <span style="color:#66d9ef">this</span>.change * <span style="color:#66d9ef">this</span>.speed * Time.deltaTime);
}
</code></pre></div><p><code>this.change * this.speed * Time.deltaTime</code>が移動量を表している（速さx時間）</p>
<p>ここで、以下のように変更してみる</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> MoveCharacter()
{
	<span style="color:#66d9ef">this</span>.change.Normalize();
	<span style="color:#66d9ef">this</span>.myRigidbody.MovePosition(<span style="color:#66d9ef">base</span>.transform.position + <span style="color:#66d9ef">this</span>.change);
}
</code></pre></div><p>ゲームを実行してみる</p>
<p>某漫画にでてくる瞬歩みたいな挙動になる（おそらく<code>this.speed * Time.deltaTime</code>が１以下の小さな値になるため）</p>
<p>池があるエリアの右上からジャングルに入る</p>
<p>さらに右上に進むとフラグがある</p>
<p><code>EXPLORERFORLIFE</code></p>
<h2 id="感想">感想</h2>
<p>難しかったです。
ほぼ丸一日かけたのにあまり解けませんでした。
もっと精進します。</p>

			</div>
		</div>
	</div>
		<div class="links">
			<a href="https://kuzushiki.github.io/">Home</a>
			
				<a href="https://kuzushiki.github.io/post/">Archive</a>
			
			
				
			
				
					<a href="https://kuzushiki.github.io/pages/resume/">Résumé</a>
				
			
			<a href="#top">Top</a>
		</div>
		
		
		<p id="copyright">
			© Copyright 2020 kuzushiki
		</p>
		
	</body>
</html>

